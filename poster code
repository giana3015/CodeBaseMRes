clc;
clear;
close all;

% Define mouse IDs and base folder
ad_mice = {'m4005', 'm4020', 'm4202', 'm4232', 'm4602', 'm4609', 'm4610'};
base_path = '/home/barrylab/Documents/Giana/Data/correlation matrix';

% Initialize storage
ad_corr_matrices = {};

for i = 1:length(ad_mice)
    mouse = ad_mice{i};
    mouse_path = fullfile(base_path, mouse);
    
    % Find all groupCorrMatrix.mat files for this mouse
    files = dir(fullfile(mouse_path, '*.groupCorrMatrix.mat'));
    
    if ~isempty(files)
        for f = 1:length(files)
            file_path = fullfile(files(f).folder, files(f).name);
            data = load(file_path);
            matrix = struct2cell(data);  % convert to cell
            matrix = matrix{1};  % extract actual matrix
            
            ad_corr_matrices{end+1} = matrix;
            fprintf('Loaded: %s\n', file_path);
        end
    else
        warning('No groupCorrMatrix.mat file found for %s', mouse);
    end
end

% Stack and average
ad_corr_stack = cat(3, ad_corr_matrices{:});
ad_corr_mean = mean(ad_corr_stack, 3, 'omitnan');

% Plot heatmap
figure;
imagesc(ad_corr_mean);
axis square;
colorbar;
caxis([-1 1]);
xlabel('Trial');
ylabel('Trial');
title('Mean Trial-by-Trial Correlation Matrix â€” AD Mice');
